<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lambda Moses" />

<meta name="date" content="2020-01-21" />

<title>Pseudotime analysis with slingshot</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">kallisto | bustools R Notebooks</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/BUStools/BUS_notebooks_R">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Pseudotime analysis with slingshot</h1>
<h4 class="author">Lambda Moses</h4>
<h4 class="date">2020-01-21</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span> workflowr <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2020-01-21
</p>
<p>
<strong>Checks:</strong> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7 <span class="glyphicon glyphicon-exclamation-sign text-danger" aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>BUS_notebooks_R/</code> <span class="glyphicon glyphicon-question-sign" aria-hidden="true" title="This is the local directory in which the code in this file was executed."> </span>
</p>
<p>
This reproducible <a href="http://rmarkdown.rstudio.com">R Markdown</a> analysis was created with <a
  href="https://github.com/jdblischak/workflowr">workflowr</a> (version 1.6.0). The <em>Checks</em> tab describes the reproducibility checks that were applied when the results were created. The <em>Past versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date </a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate" class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git repository, you know the exact version of the code that produced these results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the global environment can affect the analysis in your R Markdown file in unknown ways. For reproduciblity it’s best to always run the code in an empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20181214code"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Seed:</strong> <code>set.seed(20181214)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20181214code" class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20181214)</code> was run prior to running the code in the R Markdown file. Setting a seed ensures that any results that rely on randomness, e.g. subsampling or permutations, are reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Session information:</strong> recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be confident that you successfully produced the results during this run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomBUStoolsBUSnotebooksRtree35eece90745cd1bbe86b13838091cccdce0f82c8targetblank35eece9a"> <span class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> <strong>Repository version:</strong> <a href="https://github.com/BUStools/BUS_notebooks_R/tree/35eece90745cd1bbe86b13838091cccdce0f82c8" target="_blank">35eece9</a> </a>
</p>
</div>
<div id="strongRepositoryversionstrongahrefhttpsgithubcomBUStoolsBUSnotebooksRtree35eece90745cd1bbe86b13838091cccdce0f82c8targetblank35eece9a" class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development and connecting the code version to the results is critical for reproducibility. The version displayed above was the version of the Git repository at the time these results were generated. <br><br> Note that you need to be careful to ensure that all relevant files for the analysis have been committed to Git prior to generating the results (you can use <code>wflow_publish</code> or <code>wflow_git_commit</code>). workflowr only checks the R Markdown file, but you know if there are other scripts or data files that it depends on. Below is the status of the Git repository when the results were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    BUS_notebooks_R.Rproj
    Ignored:    analysis/figure/
    Ignored:    data/whitelist_v3.txt.gz
    Ignored:    output/.DS_Store
    Ignored:    output/out_pbmc1k/

Untracked files:
    Untracked:  ensembl/
    Untracked:  output/neuron10k/

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not included in this status report because it is ok for generated content to have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the R Markdown and HTML files. If you’ve configured a remote Git repository (see <code>?wflow_git_remote</code>), click on the hyperlinks in the table below to view them.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/35eece90745cd1bbe86b13838091cccdce0f82c8/analysis/slingshot.Rmd" target="_blank">35eece9</a>
</td>
<td>
Lambda Moses
</td>
<td>
2020-01-21
</td>
<td>
Changed explanation for updates in Seurat and Bioconductor 3.10, and so explain that I no
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/BUStools/BUS_notebooks_R/804433809d9830d258ea77acc4fda7cc64dd71a5/docs/slingshot.html" target="_blank">8044338</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/db5711cfcc5a1165381c457ef90f233abea36c02/analysis/slingshot.Rmd" target="_blank">db5711c</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
<td>
Forgot to remove irrelevant code chunks
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/BUStools/BUS_notebooks_R/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/slingshot.html" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/b6cf111c0e12d3e0f9960a0bbea7f91a23421615/analysis/slingshot.Rmd" target="_blank">b6cf111</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
<td>
Updated for new version of parsnip, and rebuilt with Ensembl 97
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/834b100d5442a5c22537dc6a6889425cc09be647/analysis/slingshot.Rmd" target="_blank">834b100</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-13
</td>
<td>
Merge branch ‘master’ of <a href="https://github.com/BUStools/BUS_notebooks_R" class="uri">https://github.com/BUStools/BUS_notebooks_R</a>
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/1fee539cd52066ff0a904626e43dc9564af320bf/analysis/slingshot.Rmd" target="_blank">1fee539</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-13
</td>
<td>
Added mode argument to rand_forest
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/f8a015aa577511662b7e1b9f8bd9ada307634f5e/analysis/slingshot.Rmd" target="_blank">f8a015a</a>
</td>
<td>
GitHub
</td>
<td>
2019-07-26
</td>
<td>
Update slingshot.Rmd
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/BUStools/BUS_notebooks_R/ababa88f09fd0c3f6a313675484d805092d69d47/docs/slingshot.html" target="_blank">ababa88</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/7c215a4bc97ef2b9a8aadab733032eab2769e735/analysis/slingshot.Rmd" target="_blank">7c215a4</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
<td>
Just realized that the Leiden clustering is not reproducible. Installed Seurat
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/BUStools/BUS_notebooks_R/906799efcbf68c48db57058869c4c360b772c270/docs/slingshot.html" target="_blank">906799e</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/63e0c03aa7048083fe7d9a72c8f351b82f35243f/analysis/slingshot.Rmd" target="_blank">63e0c03</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
<td>
slingshot notebook
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/BUStools/BUS_notebooks_R/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/slingshot.html" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/5e16aa3869c353a1808453b97f5ecbb323d0e211/analysis/slingshot.Rmd" target="_blank">5e16aa3</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
<td>
slingshot notebook
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This notebook does pseudotime analysis of the <a href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/neuron_10k_v3">10x 10k neurons from an E18 mouse</a> using <a href="https://bioconductor.org/packages/release/bioc/html/slingshot.html"><code>slingshot</code></a>, which is on Bioconductor. The notebook begins with pre-processing of the reads with the <a href="https://www.kallistobus.tools/">kallisto | bustools workflow</a> Like Monocle 2 DDRTree, <code>slingshot</code> builds a minimum spanning tree, but while Monocle 2 builds the tree from individual cells, <code>slingshot</code> does so with clusters. <code>slingshot</code> is also the top rated trajectory inference method in the <a href="https://doi.org/10.1038/s41587-019-0071-9"><code>dynverse</code> paper</a>.</p>
<p>In the <a href="https://www.biorxiv.org/content/10.1101/673285v1">kallisto | bustools paper</a>, I used the docker container for <code>slingshot</code> provided by <code>dynverse</code> for pseudotime analysis, because <code>dynverse</code> provides unified interface to dozens of different trajectory inference (TI) methods via docker containers, making it easy to try other methods without worrying about installing dependencies. Furthermore, <code>dynverse</code> provides metrics to evaluate TI methods. However, the docker images provided by <code>dynverse</code> do not provide users with the full range of options available from the TI methods themselves. For instance, while any dimension reduction and any kind of clustering can be used for <code>slingshot</code>, <code>dynverse</code> chose PCA and partition around medoids (PAM) clustering for us (see the source code <a href="https://github.com/dynverse/ti_slingshot/blob/master/package/R/ti_slingshot.R">here</a>). So in this notebook, we will directly use <code>slingshot</code> rather than via <code>dynverse</code>.</p>
<p>The gene count matrix of the 10k neuron dataset has already been generated with the kallisto | bustools pipeline and filtered for the <a href="https://bustools.github.io/BUS_notebooks_R/monocle2.html">Monocle 2 notebook</a>. Cell types have also been annotated with <code>SingleR</code> in that notebook. Please refer to the first 3 main sections of that notebook for instructions on how to use kallisto | bustools, remove empty droplets, and annotate cell types.</p>
<p>Packages <code>slingshot</code> and <code>BUSpaRse</code> are on Bioconductor (3.10). The other packages are on CRAN.</p>
<pre class="r"><code>library(slingshot)
library(BUSpaRse)
library(tidyverse)
library(tidymodels)
library(Seurat)
library(scales)
library(viridis)
library(Matrix)</code></pre>
</div>
<div id="loading-the-matrix" class="section level1">
<h1>Loading the matrix</h1>
<p>The filtered gene count matrix and the cell annotation were saved from the Monocle 2 notebook.</p>
<pre class="r"><code>annot &lt;- readRDS(&quot;./output/neuron10k/cell_type.rds&quot;)
mat_filtered &lt;- readRDS(&quot;./output/neuron10k/mat_filtered.rds&quot;)</code></pre>
<p>Just to show the structures of those 2 objects:</p>
<pre class="r"><code>dim(mat_filtered)</code></pre>
<pre><code>#&gt; [1] 23516 11037</code></pre>
<pre class="r"><code>class(mat_filtered)</code></pre>
<pre><code>#&gt; [1] &quot;dgCMatrix&quot;
#&gt; attr(,&quot;package&quot;)
#&gt; [1] &quot;Matrix&quot;</code></pre>
<p>Row names are Ensembl gene IDs.</p>
<pre class="r"><code>head(rownames(mat_filtered))</code></pre>
<pre><code>#&gt; [1] &quot;ENSMUSG00000094619.2&quot;  &quot;ENSMUSG00000095646.1&quot;  &quot;ENSMUSG00000092401.3&quot; 
#&gt; [4] &quot;ENSMUSG00000109389.1&quot;  &quot;ENSMUSG00000092212.3&quot;  &quot;ENSMUSG00000079293.11&quot;</code></pre>
<pre class="r"><code>head(colnames(mat_filtered))</code></pre>
<pre><code>#&gt; [1] &quot;AAACCCACACGCGGTT&quot; &quot;AAACCCACAGCATACT&quot; &quot;AAACCCACATACCATG&quot; &quot;AAACCCAGTCGCACAC&quot;
#&gt; [5] &quot;AAACCCAGTGCACATT&quot; &quot;AAACCCAGTGGTAATA&quot;</code></pre>
<pre class="r"><code>str(annot)</code></pre>
<pre><code>#&gt; List of 10
#&gt;  $ scores       : num [1:11037, 1:28] 0.188 0.194 0.182 0.267 0.187 ...
#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2
#&gt;   .. ..$ : chr [1:11037] &quot;AAACCCACACGCGGTT&quot; &quot;AAACCCACAGCATACT&quot; &quot;AAACCCACATACCATG&quot; &quot;AAACCCAGTCGCACAC&quot; ...
#&gt;   .. ..$ : chr [1:28] &quot;Adipocytes&quot; &quot;aNSCs&quot; &quot;Astrocytes&quot; &quot;Astrocytes activated&quot; ...
#&gt;  $ labels       : chr [1:11037, 1] &quot;NPCs&quot; &quot;NPCs&quot; &quot;NPCs&quot; &quot;NPCs&quot; ...
#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2
#&gt;   .. ..$ : chr [1, 1:11037] &quot;AAACCCACACGCGGTT&quot; &quot;AAACCCACAGCATACT&quot; &quot;AAACCCACATACCATG&quot; &quot;AAACCCAGTCGCACAC&quot; ...
#&gt;   .. ..$ : NULL
#&gt;  $ r            : num [1:11037, 1:358] 0.187 0.197 0.179 0.251 0.171 ...
#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2
#&gt;   .. ..$ : chr [1:11037] &quot;AAACCCACACGCGGTT&quot; &quot;AAACCCACAGCATACT&quot; &quot;AAACCCACATACCATG&quot; &quot;AAACCCAGTCGCACAC&quot; ...
#&gt;   .. ..$ : chr [1:358] &quot;ERR525589Aligned&quot; &quot;ERR525592Aligned&quot; &quot;SRR275532Aligned&quot; &quot;SRR275534Aligned&quot; ...
#&gt;  $ pval         : Named num [1:11037] 0.0428 0.058 0.0383 0.0111 0.0327 ...
#&gt;   ..- attr(*, &quot;names&quot;)= chr [1:11037] &quot;AAACCCACACGCGGTT&quot; &quot;AAACCCACAGCATACT&quot; &quot;AAACCCACATACCATG&quot; &quot;AAACCCAGTCGCACAC&quot; ...
#&gt;  $ labels1      : chr [1:11037, 1] &quot;NPCs&quot; &quot;NPCs&quot; &quot;NPCs&quot; &quot;NPCs&quot; ...
#&gt;   ..- attr(*, &quot;dimnames&quot;)=List of 2
#&gt;   .. ..$ : chr [1:11037] &quot;AAACCCACACGCGGTT&quot; &quot;AAACCCACAGCATACT&quot; &quot;AAACCCACATACCATG&quot; &quot;AAACCCAGTCGCACAC&quot; ...
#&gt;   .. ..$ : NULL
#&gt;  $ labels1.thres: chr [1:11037] &quot;NPCs&quot; &quot;X&quot; &quot;NPCs&quot; &quot;NPCs&quot; ...
#&gt;  $ cell.names   : chr [1:11037] &quot;AAACCCACACGCGGTT&quot; &quot;AAACCCACAGCATACT&quot; &quot;AAACCCACATACCATG&quot; &quot;AAACCCAGTCGCACAC&quot; ...
#&gt;  $ quantile.use : num 0.8
#&gt;  $ types        : chr [1:358] &quot;Adipocytes&quot; &quot;Adipocytes&quot; &quot;Adipocytes&quot; &quot;Adipocytes&quot; ...
#&gt;  $ method       : chr &quot;single&quot;</code></pre>
<p>To prevent endothelial cells, erythrocytes, immune cells, and fibroblasts from being mistaken as very differentiated cell types derived from neural stem cells, we will only keep cells with a label for the neural or glial lineage. This can be a problem as <code>slingshot</code> does not support multiple disconnected trajectories.</p>
<pre class="r"><code>ind &lt;- annot$labels %in% c(&quot;NPCs&quot;, &quot;Neurons&quot;, &quot;OPCs&quot;, &quot;Oligodendrocytes&quot;, 
                           &quot;qNSCs&quot;, &quot;aNSCs&quot;, &quot;Astrocytes&quot;, &quot;Ependymal&quot;)
cells_use &lt;- annot$cell.names[ind]
mat_filtered &lt;- mat_filtered[, cells_use]</code></pre>
<p>Meaning of the acronyms:</p>
<ul>
<li>NPCs: Neural progenitor cells</li>
<li>OPCs: Oligodendrocyte progenitor cells</li>
<li>qNSCs: Quiescent neural stem cells</li>
<li>aNSCs: Active neural stem cells</li>
</ul>
<p>Since we will do differential expression and gene symbols are more human readable than Ensembl gene IDs, we will get the corresponding gene symbols from Ensembl.</p>
<pre class="r"><code>gns &lt;- tr2g_ensembl(species = &quot;Mus musculus&quot;, use_gene_name = TRUE, 
                    ensembl_version = 97)[,c(&quot;gene&quot;, &quot;gene_name&quot;)] %&gt;% 
  distinct()</code></pre>
<pre><code>#&gt; Querying biomart for transcript and gene IDs of Mus musculus</code></pre>
<pre><code>#&gt; Cache found</code></pre>
</div>
<div id="preprocessing" class="section level1">
<h1>Preprocessing</h1>
<div id="qc" class="section level2">
<h2>QC</h2>
<pre class="r"><code>seu &lt;- CreateSeuratObject(mat_filtered) %&gt;% 
  SCTransform() # normalize and scale
# Add cell type annotation to metadata
seu &lt;- AddMetaData(seu, setNames(annot$labels[ind], cells_use), 
                   col.name = &quot;cell_type&quot;)</code></pre>
<pre class="r"><code>VlnPlot(seu, c(&quot;nCount_RNA&quot;, &quot;nFeature_RNA&quot;), pt.size = 0.1, ncol = 1, group.by = &quot;cell_type&quot;)</code></pre>
<p><img src="figure/slingshot.Rmd/vln-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-vln-1">
Past versions of vln-1.png
</button>
</p>
<div id="fig-vln-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/vln-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/vln-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>There are only 2 cells labeled ependymal.</p>
<pre class="r"><code>ggplot(seu@meta.data, aes(nCount_RNA, nFeature_RNA, color = cell_type)) +
  geom_point(size = 0.5) +
  scale_color_brewer(type = &quot;qual&quot;, palette = &quot;Set2&quot;, name = &quot;cell type&quot;) +
  scale_x_log10() +
  scale_y_log10() +
  theme_bw() +
  # Make points larger in legend
  guides(color = guide_legend(override.aes = list(size = 3))) +
  labs(x = &quot;Total UMI counts&quot;, y = &quot;Number of genes detected&quot;)</code></pre>
<p><img src="figure/slingshot.Rmd/qc-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-qc-1">
Past versions of qc-1.png
</button>
</p>
<div id="fig-qc-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/qc-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/qc-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="dimension-reduction" class="section level2">
<h2>Dimension reduction</h2>
<pre class="r"><code>seu &lt;- RunPCA(seu, npcs = 70, verbose = FALSE)
ElbowPlot(seu, ndims = 70)</code></pre>
<p><img src="figure/slingshot.Rmd/elbow-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-elbow-1">
Past versions of elbow-1.png
</button>
</p>
<div id="fig-elbow-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/elbow-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/elbow-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The y axis is standard deviation (not variance), or the singular values from singular value decomposition on the data performed for PCA.</p>
<pre class="r"><code># Need to use DimPlot due to weird workflowr problem with PCAPlot that calls seu[[wflow.build]]
# and eats up memory. I suspect this is due to the sys.call() in 
# Seurat:::SpecificDimPlot. 
DimPlot(seu, reduction = &quot;pca&quot;,
        group.by = &quot;cell_type&quot;, pt.size = 0.5, label = TRUE, repel = TRUE) +
  scale_color_brewer(type = &quot;qual&quot;, palette = &quot;Set2&quot;)</code></pre>
<pre><code>#&gt; Warning: Using `as.character()` on a quosure is deprecated as of rlang 0.3.0.
#&gt; Please use `as_label()` or `as_name()` instead.
#&gt; This warning is displayed once per session.</code></pre>
<p><img src="figure/slingshot.Rmd/pca-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-pca-1">
Past versions of pca-1.png
</button>
</p>
<div id="fig-pca-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/pca-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/pca-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>seu &lt;- RunTSNE(seu, dims = 1:50, verbose = FALSE)
DimPlot(seu, reduction = &quot;tsne&quot;,
        group.by = &quot;cell_type&quot;, pt.size = 0.5, label = TRUE, repel = TRUE) +
  scale_color_brewer(type = &quot;qual&quot;, palette = &quot;Set2&quot;)</code></pre>
<p><img src="figure/slingshot.Rmd/tsne-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-tsne-1">
Past versions of tsne-1.png
</button>
</p>
<div id="fig-tsne-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/tsne-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/tsne-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>UMAP can better preserve pairwise distance of cells than tSNE and can better separate cell populations than the first 2 PCs of PCA (<a href="https://doi.org/10.1038/nbt.4314">Becht et al. 2018</a>), so the TI will be done on UMAP rather than tSNE or PCA. The current CRAN version of Seurat uses the R package <code>uwot</code> rather than the Python version for UMAP.</p>
<pre class="r"><code>seu &lt;- RunUMAP(seu, dims = 1:50, seed.use = 4867)</code></pre>
<pre><code>#&gt; Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric
#&gt; To use Python UMAP via reticulate, set umap.method to &#39;umap-learn&#39; and metric to &#39;correlation&#39;
#&gt; This message will be shown once per session</code></pre>
<pre><code>#&gt; 03:56:17 UMAP embedding parameters a = 0.9922 b = 1.112</code></pre>
<pre><code>#&gt; 03:56:17 Read 10699 rows and found 50 numeric columns</code></pre>
<pre><code>#&gt; 03:56:17 Using Annoy for neighbor search, n_neighbors = 30</code></pre>
<pre><code>#&gt; 03:56:17 Building Annoy index with metric = cosine, n_trees = 50</code></pre>
<pre><code>#&gt; 0%   10   20   30   40   50   60   70   80   90   100%</code></pre>
<pre><code>#&gt; [----|----|----|----|----|----|----|----|----|----|</code></pre>
<pre><code>#&gt; **************************************************|
#&gt; 03:56:19 Writing NN index file to temp file /var/folders/tg/cv0dwcv11q5g13yjt9mc_nh00000gn/T//Rtmpy424Fq/file12f6927c1ba2e
#&gt; 03:56:19 Searching Annoy index using 1 thread, search_k = 3000
#&gt; 03:56:23 Annoy recall = 100%
#&gt; 03:56:26 Commencing smooth kNN distance calibration using 1 thread
#&gt; 03:56:30 Initializing from normalized Laplacian + noise
#&gt; 03:56:32 Commencing optimization for 200 epochs, with 430906 positive edges
#&gt; 03:56:41 Optimization finished</code></pre>
<pre class="r"><code>DimPlot(seu, reduction = &quot;umap&quot;,
        group.by = &quot;cell_type&quot;, pt.size = 0.5, label = TRUE, repel = TRUE) +
  scale_color_brewer(type = &quot;qual&quot;, palette = &quot;Set2&quot;)</code></pre>
<p><img src="figure/slingshot.Rmd/umap-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-umap-1">
Past versions of umap-1.png
</button>
</p>
<div id="fig-umap-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/umap-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/umap-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Cell type annotation with <code>SingleR</code> requires a reference with bulk RNA seq data for isolated known cell types. The reference used for cell type annotation here does not differentiate between different types of neural progenitor cells; clustering can further partition the neural progenitor cells. Furthermore, <code>slingshot</code> is based on cluster-wise minimum spanning tree, so finding a good clustering is important to good trajectory inference with <code>slingshot</code>. The clustering algorithm used here is <a href="https://www.nature.com/articles/s41598-019-41695-z">Leiden</a>, which is an improvement over the commonly used Louvain; Leiden communities are guaranteed to be well-connected, while Louvain can lead to poorly connected communities.</p>
<pre class="r"><code>names(seu@meta.data)</code></pre>
<pre><code>#&gt; [1] &quot;orig.ident&quot;   &quot;nCount_RNA&quot;   &quot;nFeature_RNA&quot; &quot;nCount_SCT&quot;   &quot;nFeature_SCT&quot;
#&gt; [6] &quot;cell_type&quot;</code></pre>
<pre class="r"><code>seu &lt;- FindNeighbors(seu, verbose = FALSE, dims = 1:50)
seu &lt;- FindClusters(seu, algorithm = 4, random.seed = 256, resolution = 1)</code></pre>
<pre><code>#&gt; 10653 singletons identified. 17 final clusters.</code></pre>
<pre class="r"><code>DimPlot(seu, pt.size = 0.5, reduction = &quot;umap&quot;, group.by = &quot;seurat_clusters&quot;, label = TRUE)</code></pre>
<p><img src="figure/slingshot.Rmd/umap_clust-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-umap_clust-1">
Past versions of umap_clust-1.png
</button>
</p>
<div id="fig-umap_clust-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/umap_clust-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/ababa88f09fd0c3f6a313675484d805092d69d47/docs/figure/slingshot.Rmd/umap_clust-1.png" target="_blank">ababa88</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/906799efcbf68c48db57058869c4c360b772c270/docs/figure/slingshot.Rmd/umap_clust-1.png" target="_blank">906799e</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/umap_clust-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="slingshot" class="section level1">
<h1>Slingshot</h1>
<div id="trajectory-inference" class="section level2">
<h2>Trajectory inference</h2>
<p>While the <code>slingshot</code> vignette uses <code>SingleCellExperiment</code>, <code>slingshot</code> can also take a matrix of cell embeddings in reduced dimension as input. We can optionally specify the cluster to start or end the trajectory based on biological knowledge. Here, since quiescent neural stem cells are in cluster 4, the starting cluster would be 4 near the top left of the previous plot.</p>
<p>Here, UMAP projections are used for trajectory inference, as in Monocle 3, for the purpose of visualization. However, <strong>I no longer consider this a good idea</strong>, due to distortions introduced by UMAP. See <a href="https://www.biorxiv.org/content/10.1101/689851v3">this paper</a> for the extent non-linear dimension reduction methods distort the data. The latent dimension of the data is most likely far more than 2 or 3 dimensions, so forcing it down to 2 or 3 dimensions are bound to introduce distortions, just like how projecting the spherical surface of the Earth to 2 dimensions in maps introduces distortions. Furthermore, after the projection, some trajectories are no longer topologically feasible. For instance, imagine a stream coming out of the hole of a doughnut in 3D. This is not possible in 2D, so when that structure is projected to 2D, part of the stream may become buried in the middle of the doughnut, or the doughnut may be broken to allow the stream through, or part of the steam will be intermixed with part of the doughnut though they shouldn’t. I recommend using a larger number of principal components instead, but in that case, the lineages and principal curves can’t be visualized (we can plot the curves within a 2 dimensional subspace, such as the first 2 PCs, but that usually looks like abstract art and isn’t informative about the lineages).</p>
<pre class="r"><code>sds &lt;- slingshot(Embeddings(seu, &quot;umap&quot;), clusterLabels = seu$seurat_clusters, 
                 start.clus = 4, stretch = 0)</code></pre>
<p>Unfortunately, <code>slingshot</code> does not natively support <code>ggplot2</code>. So this is a function that assigns colors to each cell in base R graphics.</p>
<pre class="r"><code>#&#39; Assign a color to each cell based on some value
#&#39; 
#&#39; @param cell_vars Vector indicating the value of a variable associated with cells.
#&#39; @param pal_fun Palette function that returns a vector of hex colors, whose
#&#39; argument is the length of such a vector.
#&#39; @param ... Extra arguments for pal_fun.
#&#39; @return A vector of hex colors with one entry for each cell.
cell_pal &lt;- function(cell_vars, pal_fun,...) {
  if (is.numeric(cell_vars)) {
    pal &lt;- pal_fun(100, ...)
    return(pal[cut(cell_vars, breaks = 100)])
  } else {
    categories &lt;- sort(unique(cell_vars))
    pal &lt;- setNames(pal_fun(length(categories), ...), categories)
    return(pal[cell_vars])
  }
}</code></pre>
<p>We need color palettes for both cell types and Leiden clusters. These would be the same colors seen in the Seurat plots.</p>
<pre class="r"><code>cell_colors &lt;- cell_pal(seu$cell_type, brewer_pal(&quot;qual&quot;, &quot;Set2&quot;))
cell_colors_clust &lt;- cell_pal(seu$seurat_clusters, hue_pal())</code></pre>
<p>What does the inferred trajectory look like compared to cell types?</p>
<pre class="r"><code>plot(reducedDim(sds), col = cell_colors, pch = 16, cex = 0.5)
lines(sds, lwd = 2, type = &#39;lineages&#39;, col = &#39;black&#39;)</code></pre>
<p><img src="figure/slingshot.Rmd/lin1-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-lin1-1">
Past versions of lin1-1.png
</button>
</p>
<div id="fig-lin1-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/lin1-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/ababa88f09fd0c3f6a313675484d805092d69d47/docs/figure/slingshot.Rmd/lin1-1.png" target="_blank">ababa88</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/lin1-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Again, the qNSCs are the brown points near the top left, NPCs are green, and neurons are pink. It seems that multiple neural lineages formed. This is a much more complicated picture than the two branches of neurons projected on the first two PCs in the pseudotime figure in the <a href="https://www.biorxiv.org/content/10.1101/673285v1">kallisto | bustools paper</a> (Supplementary Figure 6.5). It also seems that <code>slingshot</code> did not pick up the glial lineage (oligodendrocytes and astrocytes), as the vast majority of cells here are NPCs or neurons.</p>
<p>See how this looks with Leiden clusters.</p>
<pre class="r"><code>plot(reducedDim(sds), col = cell_colors_clust, pch = 16, cex = 0.5)
lines(sds, lwd = 2, type = &#39;lineages&#39;, col = &#39;black&#39;)</code></pre>
<p><img src="figure/slingshot.Rmd/lin2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-lin2-1">
Past versions of lin2-1.png
</button>
</p>
<div id="fig-lin2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/lin2-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/ababa88f09fd0c3f6a313675484d805092d69d47/docs/figure/slingshot.Rmd/lin2-1.png" target="_blank">ababa88</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/906799efcbf68c48db57058869c4c360b772c270/docs/figure/slingshot.Rmd/lin2-1.png" target="_blank">906799e</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/lin2-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here <code>slingshot</code> thinks that somewhere around cluster 6 is a point where multiple neural lineages diverge. Different clustering (e.g. different random initiations of Louvain or Leiden algorithms) can lead to somewhat different trajectories, the the main structure is not affected. With different runs of Leiden clustering (without fixed seed), the branching point is placed in the region around its current location, near the small UMAP offshoot there.</p>
<p>Principal curves are smoothed representations of each lineage; pseudotime values are computed by projecting the cells onto the principal curves. What do the principal curves look like?</p>
<pre class="r"><code>plot(reducedDim(sds), col = cell_colors, pch = 16, cex = 0.5)
lines(sds, lwd = 2, col = &#39;black&#39;)</code></pre>
<p><img src="figure/slingshot.Rmd/curves-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-curves-1">
Past versions of curves-1.png
</button>
</p>
<div id="fig-curves-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/curves-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/ababa88f09fd0c3f6a313675484d805092d69d47/docs/figure/slingshot.Rmd/curves-1.png" target="_blank">ababa88</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/curves-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Which cells are in which lineage? Here we plot the pseudotime values for each lineage.</p>
<pre class="r"><code>nc &lt;- 3
pt &lt;- slingPseudotime(sds)
nms &lt;- colnames(pt)
nr &lt;- ceiling(length(nms)/nc)
pal &lt;- viridis(100, end = 0.95)
par(mfrow = c(nr, nc))
for (i in nms) {
  colors &lt;- pal[cut(pt[,i], breaks = 100)]
  plot(reducedDim(sds), col = colors, pch = 16, cex = 0.5, main = i)
  lines(sds, lwd = 2, col = &#39;black&#39;, type = &#39;lineages&#39;)
}</code></pre>
<p><img src="figure/slingshot.Rmd/pt-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-pt-1">
Past versions of pt-1.png
</button>
</p>
<div id="fig-pt-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/804433809d9830d258ea77acc4fda7cc64dd71a5/docs/figure/slingshot.Rmd/pt-1.png" target="_blank">8044338</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/pt-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/ababa88f09fd0c3f6a313675484d805092d69d47/docs/figure/slingshot.Rmd/pt-1.png" target="_blank">ababa88</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/pt-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Some of the “lineages” seem spurious, especially those ending in clusters separated from the main lineage. Those may be distinct cell types of a different lineage from most cells mistaken by <code>slingshot</code> as highly differentiated cells from the same lineage, and SingleR does not have a reference that is detailed enough. Here manual cell type annotation with marker genes would be beneficial. Monocle 3 would have assigned disconnected trajectories to the separate clusters, but those clusters have been labeled NPCs or neurons, which must have come from neural stem cells. However, some lineages do seem reasonable, such as curves 2, 3, 5, and 7, going from qNSCs to neurons, though some lineages seem duplicated. Curves 9, 11, and 13 are saying that cell state goes back to the cluster with the qNSCs after a detour, though without more detailed manual cell type annotation, I don’t know what this means or if those “lineages” are real.</p>
</div>
<div id="differential-expression" class="section level2">
<h2>Differential expression</h2>
<p>Let’s look at which genes are differentially expressed along one of those lineages (linage 2). In <code>dynverse</code>, feature (gene) importance is calculated by using gene expression to predict pseudotime value with random forest and finding genes that contribute the most to the accuracy of the response. Since it’s really not straightforward to convert existing pseudotime results to <code>dynverse</code> format, it would be easier to build a random forest model. Variable importance will be calculated for the top 300 highly variable genes here, with <a href="https://github.com/tidymodels"><code>tidymodels</code></a>. This is to make the code run faster. There are other methods of trajectory DE as well, which may be more appropriate but more time consuming to run, such as <a href="https://bioconductor.org/packages/release/bioc/html/tradeSeq.html"><code>tradeSeq</code></a> and <a href="https://github.com/Teichlab/SpatialDE"><code>SpatialDE</code></a> (when run with one dimension).</p>
<pre class="r"><code># Get top highly variable genes
top_hvg &lt;- HVFInfo(seu) %&gt;% 
  mutate(., bc = rownames(.)) %&gt;% 
  arrange(desc(residual_variance)) %&gt;% 
  top_n(300, residual_variance) %&gt;% 
  pull(bc)
# Prepare data for random forest
dat_use &lt;- t(GetAssayData(seu, slot = &quot;data&quot;)[top_hvg,])
dat_use_df &lt;- cbind(slingPseudotime(sds)[,2], dat_use) # Do curve 2, so 2nd columnn
colnames(dat_use_df)[1] &lt;- &quot;pseudotime&quot;
dat_use_df &lt;- as.data.frame(dat_use_df[!is.na(dat_use_df[,1]),])</code></pre>
<p>The subset of data is randomly split into training and validation; the model fitted on the training set will be evaluated on the validation set.</p>
<pre class="r"><code>dat_split &lt;- initial_split(dat_use_df)
dat_train &lt;- training(dat_split)
dat_val &lt;- testing(dat_split)</code></pre>
<p><code>tidymodels</code> is a unified interface to different machine learning models, a “tidier” version of <code>caret</code>. The code chunk below can easily be adjusted to use other random forest packages as the back end, so no need to learn new syntax for those packages.</p>
<pre class="r"><code>model &lt;- rand_forest(mtry = 200, trees = 1400, min_n = 15, mode = &quot;regression&quot;) %&gt;%
  set_engine(&quot;ranger&quot;, importance = &quot;impurity&quot;, num.threads = 3) %&gt;%
  fit(pseudotime ~ ., data = dat_train)</code></pre>
<p>The model is evaluated on the validation set with 3 metrics: room mean squared error (RMSE), coefficient of determination using correlation (rsq, between 0 and 1), and mean absolute error (MAE).</p>
<pre class="r"><code>val_results &lt;- dat_val %&gt;% 
  mutate(estimate = predict(model, .[,-1]) %&gt;% pull()) %&gt;% 
  select(truth = pseudotime, estimate)
metrics(data = val_results, truth, estimate)</code></pre>
<pre><code>#&gt; # A tibble: 3 x 3
#&gt;   .metric .estimator .estimate
#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
#&gt; 1 rmse    standard       1.47 
#&gt; 2 rsq     standard       0.962
#&gt; 3 mae     standard       0.739</code></pre>
<p>RMSE and MAE should have the same unit as the data. As pseudotime values here usually have values much larger than 2, the error isn’t too bad. Correlation (rsq) between <code>slingshot</code>’s pseudotime and random forest’s prediction is very high, also showing good prediction from the top 300 highly variable genes.</p>
<pre class="r"><code>summary(dat_use_df$pseudotime)</code></pre>
<pre><code>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;   0.000   4.172  13.385  11.914  18.177  24.116</code></pre>
<p>Now it’s time to plot some genes deemed the most important to predicting pseudotime:</p>
<pre class="r"><code>var_imp &lt;- sort(model$fit$variable.importance, decreasing = TRUE)
top_genes &lt;- names(var_imp)[1:6]
# Convert to gene symbol
top_gene_name &lt;- gns$gene_name[match(top_genes, gns$gene)]</code></pre>
<pre class="r"><code>par(mfrow = c(3, 2))
for (i in seq_along(top_genes)) {
  colors &lt;- pal[cut(dat_use[,top_genes[i]], breaks = 100)]
  plot(reducedDim(sds), col = colors, 
       pch = 16, cex = 0.5, main = top_gene_name[i])
  lines(sds, lwd = 2, col = &#39;black&#39;, type = &#39;lineages&#39;)
}</code></pre>
<p><img src="figure/slingshot.Rmd/genes-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-genes-1">
Past versions of genes-1.png
</button>
</p>
<div id="fig-genes-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/0a4efbd74ecbf1edf38424113196fa79ad2726f5/docs/figure/slingshot.Rmd/genes-1.png" target="_blank">0a4efbd</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-08-15
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/ababa88f09fd0c3f6a313675484d805092d69d47/docs/figure/slingshot.Rmd/genes-1.png" target="_blank">ababa88</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
<tr>
<td>
<a href="https://github.com/BUStools/BUS_notebooks_R/blob/df34d05137c8df23b272650d0e14a8becfe6ad76/docs/figure/slingshot.Rmd/genes-1.png" target="_blank">df34d05</a>
</td>
<td>
Lambda Moses
</td>
<td>
2019-07-24
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>These genes do highlight different parts of the trajectory. A quick search on PubMed did show relevance of these genes to development of the central nervous system in mice.</p>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>#&gt; R version 3.6.2 (2019-12-12)
#&gt; Platform: x86_64-apple-darwin15.6.0 (64-bit)
#&gt; Running under: macOS Catalina 10.15.1
#&gt; 
#&gt; Matrix products: default
#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRblas.0.dylib
#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/3.6/Resources/lib/libRlapack.dylib
#&gt; 
#&gt; locale:
#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt;  [1] Matrix_1.2-18     viridis_0.5.1     viridisLite_0.3.0 Seurat_3.1.2     
#&gt;  [5] yardstick_0.0.4   rsample_0.0.5     recipes_0.1.9     parsnip_0.0.5    
#&gt;  [9] infer_0.5.1       dials_0.0.4       scales_1.1.0      broom_0.5.3      
#&gt; [13] tidymodels_0.0.3  forcats_0.4.0     stringr_1.4.0     dplyr_0.8.3      
#&gt; [17] purrr_0.3.3       readr_1.3.1       tidyr_1.0.0       tibble_2.1.3     
#&gt; [21] ggplot2_3.2.1     tidyverse_1.3.0   BUSpaRse_1.0.0    slingshot_1.4.0  
#&gt; [25] princurve_2.1.4   workflowr_1.6.0  
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;   [1] rappdirs_0.3.1              SnowballC_0.6.0            
#&gt;   [3] rtracklayer_1.46.0          R.methodsS3_1.7.1          
#&gt;   [5] bit64_0.9-7                 knitr_1.27                 
#&gt;   [7] multcomp_1.4-12             irlba_2.3.3                
#&gt;   [9] dygraphs_1.1.1.6            DelayedArray_0.12.2        
#&gt;  [11] R.utils_2.9.2               data.table_1.12.8          
#&gt;  [13] rpart_4.1-15                inline_0.3.15              
#&gt;  [15] RCurl_1.98-1.1              AnnotationFilter_1.10.0    
#&gt;  [17] generics_0.0.2              metap_1.2                  
#&gt;  [19] BiocGenerics_0.32.0         GenomicFeatures_1.38.0     
#&gt;  [21] TH.data_1.0-10              cowplot_1.0.0              
#&gt;  [23] callr_3.4.0                 RSQLite_2.2.0              
#&gt;  [25] RANN_2.6.1                  future_1.16.0              
#&gt;  [27] bit_1.1-15.1                tokenizers_0.2.1           
#&gt;  [29] mutoss_0.1-12               xml2_1.2.2                 
#&gt;  [31] lubridate_1.7.4             httpuv_1.5.2               
#&gt;  [33] StanHeaders_2.21.0-1        SummarizedExperiment_1.16.1
#&gt;  [35] assertthat_0.2.1            gower_0.2.1                
#&gt;  [37] xfun_0.12                   hms_0.5.3                  
#&gt;  [39] bayesplot_1.7.1             evaluate_0.14              
#&gt;  [41] promises_1.1.0              fansi_0.4.1                
#&gt;  [43] progress_1.2.2              caTools_1.18.0             
#&gt;  [45] dbplyr_1.4.2                readxl_1.3.1               
#&gt;  [47] igraph_1.2.4.2              DBI_1.1.0                  
#&gt;  [49] htmlwidgets_1.5.1           stats4_3.6.2               
#&gt;  [51] RSpectra_0.16-0             crosstalk_1.0.0            
#&gt;  [53] backports_1.1.5             markdown_1.1               
#&gt;  [55] gbRd_0.4-11                 RcppParallel_4.4.4         
#&gt;  [57] biomaRt_2.42.0              vctrs_0.2.1                
#&gt;  [59] SingleCellExperiment_1.8.0  Biobase_2.46.0             
#&gt;  [61] ensembldb_2.10.2            ROCR_1.0-7                 
#&gt;  [63] withr_2.1.2                 BSgenome_1.54.0            
#&gt;  [65] sctransform_0.2.1           GenomicAlignments_1.22.1   
#&gt;  [67] xts_0.12-0                  prettyunits_1.1.0          
#&gt;  [69] mnormt_1.5-5                cluster_2.1.0              
#&gt;  [71] ape_5.3                     lazyeval_0.2.2             
#&gt;  [73] crayon_1.3.4                labeling_0.3               
#&gt;  [75] pkgconfig_2.0.3             GenomeInfoDb_1.22.0        
#&gt;  [77] nlme_3.1-142                ProtGenerics_1.18.0        
#&gt;  [79] nnet_7.3-12                 rlang_0.4.2                
#&gt;  [81] globals_0.12.5              lifecycle_0.1.0            
#&gt;  [83] miniUI_0.1.1.1              sandwich_2.5-1             
#&gt;  [85] colourpicker_1.0            BiocFileCache_1.10.2       
#&gt;  [87] rsvd_1.0.2                  modelr_0.1.5               
#&gt;  [89] tidytext_0.2.2              cellranger_1.1.0           
#&gt;  [91] rprojroot_1.3-2             lmtest_0.9-37              
#&gt;  [93] matrixStats_0.55.0          loo_2.2.0                  
#&gt;  [95] boot_1.3-23                 zoo_1.8-7                  
#&gt;  [97] reprex_0.3.0                base64enc_0.1-3            
#&gt;  [99] whisker_0.4                 ggridges_0.5.2             
#&gt; [101] processx_3.4.1              png_0.1-7                  
#&gt; [103] bitops_1.0-6                R.oo_1.23.0                
#&gt; [105] KernSmooth_2.23-16          pROC_1.16.1                
#&gt; [107] Biostrings_2.54.0           blob_1.2.1                 
#&gt; [109] shinystan_2.5.0             S4Vectors_0.24.3           
#&gt; [111] ica_1.0-2                   memoise_1.1.0              
#&gt; [113] magrittr_1.5                plyr_1.8.5                 
#&gt; [115] gplots_3.0.1.2              bibtex_0.4.2.2             
#&gt; [117] gdata_2.18.0                zlibbioc_1.32.0            
#&gt; [119] threejs_0.3.1               compiler_3.6.2             
#&gt; [121] lsei_1.2-0                  rstantools_2.0.0           
#&gt; [123] RColorBrewer_1.1-2          plotrix_3.7-7              
#&gt; [125] lme4_1.1-21                 fitdistrplus_1.0-14        
#&gt; [127] Rsamtools_2.2.1             cli_2.0.1                  
#&gt; [129] XVector_0.26.0              DiceDesign_1.8-1           
#&gt; [131] listenv_0.8.0               pbapply_1.4-2              
#&gt; [133] janeaustenr_0.1.5           ps_1.3.0                   
#&gt; [135] MASS_7.3-51.4               tidyselect_0.2.5           
#&gt; [137] stringi_1.4.5               yaml_2.2.0                 
#&gt; [139] askpass_1.1                 ggrepel_0.8.1              
#&gt; [141] grid_3.6.2                  tidypredict_0.4.3          
#&gt; [143] tools_3.6.2                 future.apply_1.4.0         
#&gt; [145] parallel_3.6.2              rstudioapi_0.10            
#&gt; [147] git2r_0.26.1                gridExtra_2.3              
#&gt; [149] prodlim_2019.11.13          farver_2.0.3               
#&gt; [151] plyranges_1.6.5             Rtsne_0.15                 
#&gt; [153] digest_0.6.23               shiny_1.4.0                
#&gt; [155] lava_1.6.6                  Rcpp_1.0.3                 
#&gt; [157] GenomicRanges_1.38.0        SDMTools_1.1-221.2         
#&gt; [159] later_1.0.0                 RcppAnnoy_0.0.14           
#&gt; [161] httr_1.4.1                  AnnotationDbi_1.48.0       
#&gt; [163] rsconnect_0.8.16            npsurv_0.4-0               
#&gt; [165] Rdpack_0.11-1               colorspace_1.4-1           
#&gt; [167] ranger_0.12.1               reticulate_1.14            
#&gt; [169] rvest_0.3.5                 XML_3.99-0.3               
#&gt; [171] fs_1.3.1                    IRanges_2.20.2             
#&gt; [173] splines_3.6.2               uwot_0.1.5                 
#&gt; [175] sn_1.5-4                    multtest_2.42.0            
#&gt; [177] shinythemes_1.1.2           plotly_4.9.1               
#&gt; [179] xtable_1.8-4                rstanarm_2.19.2            
#&gt; [181] jsonlite_1.6                nloptr_1.2.1               
#&gt; [183] timeDate_3043.102           rstan_2.19.2               
#&gt; [185] zeallot_0.1.0               ipred_0.9-9                
#&gt; [187] R6_2.4.1                    TFisher_0.2.0              
#&gt; [189] pillar_1.4.3                htmltools_0.4.0            
#&gt; [191] mime_0.8                    glue_1.3.1                 
#&gt; [193] fastmap_1.0.1               minqa_1.2.4                
#&gt; [195] DT_0.11                     BiocParallel_1.20.1        
#&gt; [197] class_7.3-15                codetools_0.2-16           
#&gt; [199] utf8_1.1.4                  tsne_0.1-3                 
#&gt; [201] mvtnorm_1.0-12              pkgbuild_1.0.6             
#&gt; [203] furrr_0.1.0                 lattice_0.20-38            
#&gt; [205] numDeriv_2016.8-1.1         curl_4.3                   
#&gt; [207] leiden_0.3.2                gtools_3.8.1               
#&gt; [209] tidyposterior_0.0.2         shinyjs_1.1                
#&gt; [211] openssl_1.4.1               survival_3.1-8             
#&gt; [213] rmarkdown_2.1               munsell_0.5.0              
#&gt; [215] GenomeInfoDbData_1.2.2      haven_2.2.0                
#&gt; [217] reshape2_1.4.3              gtable_0.3.0</code></pre>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
http://docs.mathjax.org/en/latest/configuration.html.  This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
